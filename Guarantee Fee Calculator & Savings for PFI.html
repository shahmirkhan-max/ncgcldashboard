<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NCGCL Benefit Estimator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #2563eb;
            cursor: pointer;
            margin-top: -6px; 
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #e5e7eb;
            border-radius: 2px;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // -- Inline Icon Components --
        // Replaces external library dependency to prevent runtime errors
        const IconWrapper = ({ children, className = "", size = 20, color = "currentColor" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke={color} 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {children}
            </svg>
        );

        const CalculatorIcon = (props) => (
            <IconWrapper {...props}>
                <rect x="4" y="2" width="16" height="20" rx="2"></rect>
                <line x1="8" x2="16" y1="6" y2="6"></line>
                <line x1="16" x2="16" y1="14" y2="14"></line>
                <line x1="12" x2="12" y1="14" y2="14"></line>
                <line x1="8" x2="8" y1="14" y2="14"></line>
                <line x1="16" x2="16" y1="18" y2="18"></line>
                <line x1="12" x2="12" y1="18" y2="18"></line>
                <line x1="8" x2="8" y1="18" y2="18"></line>
            </IconWrapper>
        );

        const TrendingUpIcon = (props) => (
            <IconWrapper {...props}>
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </IconWrapper>
        );

        const ShieldCheckIcon = (props) => (
            <IconWrapper {...props}>
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                <path d="m9 12 2 2 4-4"></path>
            </IconWrapper>
        );

        const DollarSignIcon = (props) => (
            <IconWrapper {...props}>
                <line x1="12" x2="12" y1="1" y2="23"></line>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </IconWrapper>
        );

        const PieChartIcon = (props) => (
            <IconWrapper {...props}>
                <path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path>
                <path d="M22 12A10 10 0 0 0 12 2v10z"></path>
            </IconWrapper>
        );

        const AlertTriangleIcon = (props) => (
            <IconWrapper {...props}>
                <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path>
                <line x1="12" y1="9" x2="12" y2="13"></line>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </IconWrapper>
        );

        const HelpCircleIcon = (props) => (
            <IconWrapper {...props}>
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </IconWrapper>
        );

        // Components
        const Card = ({ children, className = "" }) => (
            <div className={`bg-white rounded-xl shadow-sm border border-gray-200 p-6 transition-all duration-300 ${className}`}>
                {children}
            </div>
        );

        const Tooltip = ({ text }) => (
            <div className="group relative inline-block ml-1 align-middle">
                <HelpCircleIcon className="w-4 h-4 text-gray-400" size={16} />
                <div className="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block w-48 bg-gray-800 text-white text-xs rounded p-2 z-10 text-center shadow-lg">
                    {text}
                    <div className="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-800"></div>
                </div>
            </div>
        );

        const SliderInput = ({ label, value, onChange, min, max, step, unit = "", tooltip }) => (
            <div className="mb-5">
                <div className="flex justify-between mb-2 items-center">
                    <div className="flex items-center">
                        <label className="text-sm font-medium text-gray-700 mr-1">{label}</label>
                        {tooltip && <Tooltip text={tooltip} />}
                    </div>
                    <span className="text-sm font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded border border-blue-100 min-w-[60px] text-center">{value}{unit}</span>
                </div>
                <input
                    type="range"
                    min={min}
                    max={max}
                    step={step}
                    value={value}
                    onChange={(e) => onChange(parseFloat(e.target.value))}
                    className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer focus:outline-none"
                />
                <div className="flex justify-between text-xs text-gray-400 mt-1">
                    <span>{min}{unit}</span>
                    <span>{max}{unit}</span>
                </div>
            </div>
        );

        const StatBox = ({ label, value, subtext, positive = true, icon }) => (
            <div className="p-4 bg-white rounded-lg border border-gray-100 shadow-sm flex flex-col h-full relative overflow-hidden card-hover">
                <div className={`absolute top-0 right-0 p-2 opacity-10 ${positive ? 'text-green-600' : 'text-red-600'}`}>
                    {icon}
                </div>
                <div className="text-xs text-gray-500 uppercase tracking-wider mb-2 font-semibold">{label}</div>
                <div className={`text-2xl font-bold mb-1 ${positive ? 'text-gray-800' : 'text-gray-800'}`}>
                    {value}
                </div>
                {subtext && (
                    <div className={`text-xs font-medium mt-auto flex items-center gap-1 ${positive ? 'text-green-600' : 'text-red-500'}`}>
                        {positive ? <TrendingUpIcon className="w-3 h-3" size={12}/> : null}
                        {subtext}
                    </div>
                )}
            </div>
        );

        const ComparisonBar = ({ label, val1, val2, max, format = (v) => v, color1 = "bg-gray-300", color2 = "bg-blue-600", label1="Without NCGCL", label2="With NCGCL" }) => {
            // Avoid division by zero
            const safeMax = max > 0 ? max : 1;
            const p1 = Math.min((val1 / safeMax) * 100, 100);
            const p2 = Math.min((val2 / safeMax) * 100, 100);
            
            return (
                <div className="mb-6">
                    <div className="flex justify-between text-sm font-medium text-gray-700 mb-2">
                        <span>{label}</span>
                    </div>
                    
                    {/* Bar 1 */}
                    <div className="mb-2">
                        <div className="flex justify-between text-xs mb-1">
                            <span className="text-gray-500">{label1}</span>
                            <span className="font-bold text-gray-700">{format(val1)}</span>
                        </div>
                        <div className="w-full h-3 bg-gray-100 rounded-full overflow-hidden">
                            <div style={{ width: `${p1}%` }} className={`h-full ${color1} rounded-full transition-all duration-700 ease-out`}></div>
                        </div>
                    </div>

                    {/* Bar 2 */}
                    <div>
                        <div className="flex justify-between text-xs mb-1">
                            <span className="text-blue-600 font-medium">{label2}</span>
                            <span className="font-bold text-blue-700">{format(val2)}</span>
                        </div>
                        <div className="w-full h-3 bg-gray-100 rounded-full overflow-hidden">
                            <div style={{ width: `${p2}%` }} className={`h-full ${color2} rounded-full transition-all duration-700 ease-out shadow-[0_0_10px_rgba(37,99,235,0.3)]`}></div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            // -- Constants --
            const FEE_RATES = {
                'FL': 2.0,
                'PP': 1.5,
                'SL': 0.85,
                'MPO': 1.0
            };

            const TYPE_DESCRIPTIONS = {
                'FL': "First Loss: NCGCL absorbs the first loss up to the coverage amount.",
                'PP': "Pari Passu: Losses shared pro-rata between FI and NCGCL.",
                'SL': "Second Loss: NCGCL pays only after FI's first loss layer is exhausted.",
                'MPO': "Mezzanine Provisioning Offset: Guarantee treated as liquid asset for FSV benefit."
            };

            // -- State --
            const [activeTab, setActiveTab] = useState('performing'); // performing | stressed
            
            // Inputs
            const [exposure, setExposure] = useState(100); // PKR Million
            const [pd, setPd] = useState(5); // %
            const [lgd, setLgd] = useState(45); // %
            const [provisionRate, setProvisionRate] = useState(50); // % (For MPO)
            const [coverage, setCoverage] = useState(30); // %
            const [guaranteeType, setGuaranteeType] = useState('FL'); // FL, SL, PP, MPO
            const [feeRate, setFeeRate] = useState(2.0); // % p.a. (Initialized to FL default)
            const [car, setCar] = useState(11.5); // Capital Adequacy Ratio %


            // -- Calculations --

            // 1. Fee Calculation
            // Fee is usually on the covered amount.
            const coveredAmount = exposure * (coverage / 100);
            // Use the dynamic feeRate instead of the static lookup
            const annualFee = coveredAmount * (feeRate / 100);

            // 2. ECL (Expected Credit Loss) - For Performing Loans
            // Without NCGCL
            const baseECL = exposure * (pd / 100) * (lgd / 100);
            
            // With NCGCL
            // Doc logic: Effective LGD = LGD * (1 - Coverage%)
            // This simplified approach matches the document's example for FL/PP/SL
            const effectiveLGD = lgd * (1 - (coverage / 100));
            const guaranteedECL = exposure * (pd / 100) * (effectiveLGD / 100);
            
            const eclSaving = baseECL - guaranteedECL;
            const netECLBenefit = eclSaving - annualFee;

            // 3. Capital Relief (RWA)
            // Without NCGCL: 100% Risk Weight
            const rwaWithout = exposure * 1.0; 
            const capitalReqWithout = rwaWithout * (car / 100);

            // With NCGCL: Covered part 20%, Uncovered 100%
            const rwaGuaranteedPart = coveredAmount * 0.20;
            const rwaUnguaranteedPart = (exposure - coveredAmount) * 1.0;
            const rwaWith = rwaGuaranteedPart + rwaUnguaranteedPart;
            const capitalReqWith = rwaWith * (car / 100);

            const capitalSaved = capitalReqWithout - capitalReqWith;

            // 4. MPO Provisioning Benefit - For Stressed/Classified Loans
            // Without MPO
            const provWithout = exposure * (provisionRate / 100);
            
            // With MPO
            // FSV Benefit = Covered Amount (Assuming k-factor allows full recognition as per doc examples)
            // According to Doc: "Revised net exposure = Exposure - GuaranteeFSV"
            // "Provision = Revised Net Exposure * Provision Rate"
            const recognizedFSV = coveredAmount;
            const netExposureMPO = Math.max(0, exposure - recognizedFSV);
            const provWith = netExposureMPO * (provisionRate / 100);
            
            const provSaving = provWithout - provWith;
            const netMPOBenefit = provSaving - annualFee; // Immediate P&L impact

            // Formatters
            const fmt = (n) => "PKR " + n.toFixed(2) + " M";
            const fmtP = (n) => n.toFixed(1) + "%";
            const fmtVal = (n) => n.toFixed(2);

            return (
                <div className="min-h-screen p-4 md:p-8 max-w-7xl mx-auto animate-fade-in">
                    {/* Header */}
                    <div className="mb-8 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        <div>
                            <h1 className="text-3xl font-bold text-gray-900 tracking-tight">NCGCL Impact Dashboard</h1>
                            <p className="text-gray-500 mt-1">Visualize the financial impact of credit guarantees on Provisions, ECL, and Capital.</p>
                        </div>
                        <div className="bg-white px-4 py-2 rounded-lg shadow-sm border border-gray-200 text-sm text-gray-600">
                            <span className="font-bold text-blue-600">Partner FI View</span> | Based on SBP Regulatory Treatment
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                        
                        {/* LEFT COLUMN: CONTROLS */}
                        <div className="lg:col-span-4 space-y-6">
                            <Card className="bg-white border-l-4 border-l-blue-500">
                                <h2 className="text-lg font-bold text-gray-800 mb-6 flex items-center gap-2 border-b pb-2">
                                    <CalculatorIcon className="w-5 h-5" /> Configuration
                                </h2>

                                {/* Context Switcher */}
                                <div className="flex bg-gray-100 p-1 rounded-lg mb-6 relative">
                                    <button 
                                        onClick={() => { 
                                            setActiveTab('performing'); 
                                            setGuaranteeType('FL'); 
                                            setFeeRate(FEE_RATES['FL']);
                                        }}
                                        className={`flex-1 py-2 px-3 rounded-md text-sm font-bold transition-all z-10 ${activeTab === 'performing' ? 'bg-white shadow text-blue-600' : 'text-gray-500 hover:text-gray-700'}`}
                                    >
                                        Performing Loans
                                    </button>
                                    <button 
                                        onClick={() => { 
                                            setActiveTab('stressed'); 
                                            setGuaranteeType('MPO'); 
                                            setFeeRate(FEE_RATES['MPO']);
                                        }}
                                        className={`flex-1 py-2 px-3 rounded-md text-sm font-bold transition-all z-10 ${activeTab === 'stressed' ? 'bg-white shadow text-red-600' : 'text-gray-500 hover:text-gray-700'}`}
                                    >
                                        Stressed Assets
                                    </button>
                                </div>

                                {/* Common Inputs */}
                                <div className="space-y-1">
                                    <SliderInput 
                                        label="Portfolio Exposure" 
                                        value={exposure} min={10} max={5000} step={10} unit=" M" 
                                        onChange={setExposure} 
                                        tooltip="Total Outstanding Amount of the loan portfolio."
                                    />
                                    <SliderInput 
                                        label="Guarantee Coverage" 
                                        value={coverage} min={10} max={60} step={5} unit="%" 
                                        onChange={setCoverage} 
                                        tooltip="Percentage of exposure covered by NCGCL."
                                    />
                                </div>

                                {activeTab === 'performing' && (
                                    <div className="animate-fade-in">
                                        <div className="mb-6">
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Product Structure</label>
                                            <div className="grid grid-cols-3 gap-2">
                                                {['FL', 'PP', 'SL'].map(type => (
                                                    <button
                                                        key={type}
                                                        onClick={() => {
                                                            setGuaranteeType(type);
                                                            setFeeRate(FEE_RATES[type]);
                                                        }}
                                                        className={`py-2 text-sm font-bold rounded border transition-colors ${guaranteeType === type ? 'bg-blue-600 border-blue-600 text-white' : 'bg-white border-gray-200 text-gray-600 hover:bg-gray-50'}`}
                                                    >
                                                        {type}
                                                    </button>
                                                ))}
                                            </div>
                                            <div className="mt-2 p-3 bg-blue-50 rounded-lg text-xs text-blue-800 border border-blue-100 mb-4">
                                                <p className="font-bold mb-1">{guaranteeType} Guarantee</p>
                                                <p className="mb-1">{TYPE_DESCRIPTIONS[guaranteeType]}</p>
                                            </div>

                                            <SliderInput 
                                                label="Guarantee Fee Rate" 
                                                value={feeRate} min={0.1} max={5.0} step={0.05} unit="% p.a." 
                                                onChange={setFeeRate} 
                                                tooltip="Annual fee charged by NCGCL on the guaranteed amount."
                                            />
                                        </div>

                                        <SliderInput label="Prob. of Default (PD)" value={pd} min={0.5} max={20} step={0.5} unit="%" onChange={setPd} tooltip="Likelihood of borrower default within one year." />
                                        <SliderInput label="Loss Given Default (LGD)" value={lgd} min={10} max={100} step={5} unit="%" onChange={setLgd} tooltip="Percentage of exposure lost if default occurs." />
                                        <SliderInput label="Min. CAR Requirement" value={car} min={8} max={20} step={0.5} unit="%" onChange={setCar} tooltip="Regulatory Capital Adequacy Ratio required by SBP." />
                                    </div>
                                )}

                                {activeTab === 'stressed' && (
                                    <div className="animate-fade-in">
                                        <div className="p-4 bg-red-50 rounded-lg border border-red-100 mb-6">
                                            <div className="text-sm font-bold text-red-800 flex items-center gap-2 mb-2">
                                                <AlertTriangleIcon className="w-4 h-4"/> MPO Structure
                                            </div>
                                            <p className="text-xs text-red-700 leading-relaxed mb-4">
                                                Mezzanine Provisioning Offset allows the guarantee to be treated as an FSV-eligible liquid asset.
                                            </p>
                                            <div className="border-t border-red-200 pt-4">
                                                 <SliderInput 
                                                    label="Guarantee Fee Rate" 
                                                    value={feeRate} min={0.1} max={5.0} step={0.05} unit="% p.a." 
                                                    onChange={setFeeRate} 
                                                    tooltip="Annual fee charged by NCGCL on the guaranteed amount."
                                                />
                                            </div>
                                        </div>
                                        <SliderInput 
                                            label="Required Provision Rate" 
                                            value={provisionRate} min={10} max={100} step={5} unit="%" 
                                            onChange={setProvisionRate} 
                                            tooltip="Provisioning percentage required for the specific classification category (e.g., OAEM, Substandard, Doubtful, Loss)."
                                        />
                                    </div>
                                )}
                            </Card>
                        </div>

                        {/* RIGHT COLUMN: RESULTS */}
                        <div className="lg:col-span-8 space-y-6">
                            
                            {/* TOP STATS ROW */}
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                {activeTab === 'performing' ? (
                                    <>
                                        <StatBox 
                                            label="Net ECL Benefit" 
                                            value={`${fmt(netECLBenefit)}`} 
                                            subtext="Annual P&L Saving" 
                                            icon={<TrendingUpIcon className="w-5 h-5" />}
                                        />
                                        <StatBox 
                                            label="Capital Released" 
                                            value={`${fmt(capitalSaved)}`} 
                                            subtext={`@ ${car}% CAR`} 
                                            icon={<PieChartIcon className="w-5 h-5" />}
                                        />
                                        <StatBox 
                                            label="Total Value Created" 
                                            value={`${fmt(netECLBenefit + (capitalSaved * 0.15))}`} 
                                            subtext="Assuming 15% ROE on Cap." 
                                            icon={<DollarSignIcon className="w-5 h-5" />}
                                        />
                                    </>
                                ) : (
                                    <>
                                        <StatBox 
                                            label="Provision Released" 
                                            value={`${fmt(provSaving)}`} 
                                            subtext="Immediate P&L Boost" 
                                            icon={<ShieldCheckIcon className="w-5 h-5" />}
                                        />
                                        <StatBox 
                                            label="Guarantee Cost" 
                                            value={`${fmt(annualFee)}`} 
                                            subtext="Annual Expense" 
                                            positive={false}
                                            icon={<DollarSignIcon className="w-5 h-5" />}
                                        />
                                        <StatBox 
                                            label="Net P&L Impact" 
                                            value={`${fmt(netMPOBenefit)}`} 
                                            subtext="Saving minus Fee" 
                                            icon={<TrendingUpIcon className="w-5 h-5" />}
                                        />
                                    </>
                                )}
                            </div>

                            {/* MAIN CONTENT AREA */}
                            {activeTab === 'performing' && (
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 animate-fade-in">
                                    {/* ECL Analysis Card */}
                                    <Card>
                                        <h3 className="text-md font-bold text-gray-800 mb-6 flex items-center gap-2 border-b pb-2">
                                            <span className="bg-blue-100 p-1 rounded text-blue-600"><TrendingUpIcon size={16}/></span>
                                            Expected Credit Loss (ECL)
                                        </h3>
                                        
                                        <ComparisonBar 
                                            label="Annual ECL Charge" 
                                            val1={baseECL} 
                                            val2={guaranteedECL} 
                                            max={Math.max(baseECL, guaranteedECL) * 1.2} 
                                            format={fmt}
                                            color1="bg-gray-300"
                                            color2="bg-green-500"
                                        />
                                        
                                        <div className="mt-6 space-y-3 bg-gray-50 p-4 rounded-lg border border-gray-100">
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-600">Gross ECL Saving</span>
                                                <span className="font-bold text-green-600">{fmt(eclSaving)}</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-600">Guarantee Fee ({fmtVal(feeRate)}%)</span>
                                                <span className="font-medium text-red-500">-{fmt(annualFee)}</span>
                                            </div>
                                            <div className="pt-2 border-t border-gray-200 flex justify-between text-sm font-bold">
                                                <span className="text-gray-800">Net Annual Benefit</span>
                                                <span className="text-blue-600">{fmt(netECLBenefit)}</span>
                                            </div>
                                        </div>
                                    </Card>

                                    {/* Capital Analysis Card */}
                                    <Card>
                                        <h3 className="text-md font-bold text-gray-800 mb-6 flex items-center gap-2 border-b pb-2">
                                            <span className="bg-purple-100 p-1 rounded text-purple-600"><PieChartIcon size={16}/></span>
                                            Capital Efficiency (RWA)
                                        </h3>
                                        
                                        <ComparisonBar 
                                            label="Risk Weighted Assets" 
                                            val1={rwaWithout} 
                                            val2={rwaWith} 
                                            max={rwaWithout * 1.1} 
                                            format={fmt}
                                            color1="bg-gray-300"
                                            color2="bg-purple-500"
                                        />

                                        <div className="mt-6 space-y-3 bg-gray-50 p-4 rounded-lg border border-gray-100">
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-600">RWA Reduction</span>
                                                <span className="font-bold text-purple-600">{fmt(rwaWithout - rwaWith)}</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-600">Min. Capital Required ({car}%)</span>
                                                <div className="text-right">
                                                    <div className="text-xs text-gray-400 line-through">{fmt(capitalReqWithout)}</div>
                                                    <div className="font-bold text-gray-800">{fmt(capitalReqWith)}</div>
                                                </div>
                                            </div>
                                            <div className="pt-2 border-t border-gray-200 flex justify-between text-sm font-bold">
                                                <span className="text-gray-800">Capital Freed Up</span>
                                                <span className="text-green-600">{fmt(capitalSaved)}</span>
                                            </div>
                                        </div>
                                    </Card>
                                </div>
                            )}

                            {activeTab === 'stressed' && (
                                <Card className="animate-fade-in border-t-4 border-t-red-500">
                                    <div className="flex justify-between items-start mb-6 border-b pb-4">
                                        <div>
                                            <h3 className="text-lg font-bold text-gray-800 flex items-center gap-2">
                                                <AlertTriangleIcon className="text-red-500 w-5 h-5"/> Provisioning Impact (MPO)
                                            </h3>
                                            <p className="text-sm text-gray-500 mt-1">
                                                Impact on Profit Before Tax (PBT) through FSV benefit recognition.
                                            </p>
                                        </div>
                                        <div className="text-right">
                                            <span className="block text-xs text-gray-400 uppercase font-bold">Net P&L Benefit</span>
                                            <span className="text-2xl font-bold text-green-600">{fmt(netMPOBenefit)}</span>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                        <div>
                                            <ComparisonBar 
                                                label="Required Provision Amount" 
                                                val1={provWithout} 
                                                val2={provWith} 
                                                max={provWithout * 1.1} 
                                                format={fmt}
                                                color1="bg-gray-400"
                                                color2="bg-green-500"
                                                label1="Provision w/o MPO"
                                                label2="Provision with MPO"
                                            />
                                            <p className="text-xs text-gray-500 mt-4 italic">
                                                * MPO effectively reduces the "Net Exposure" for provisioning by treating the guaranteed portion as a liquid asset (FSV).
                                            </p>
                                        </div>
                                        
                                        <div className="flex flex-col justify-center space-y-4">
                                            <div className="bg-green-50 p-4 rounded-lg border border-green-100">
                                                <div className="flex justify-between items-center mb-2">
                                                    <span className="text-green-800 font-medium">Provision Released</span>
                                                    <span className="text-xl font-bold text-green-700">{fmt(provSaving)}</span>
                                                </div>
                                                <div className="text-xs text-green-600">
                                                    Direct addition to bottom-line profitability.
                                                </div>
                                            </div>

                                            <div className="bg-red-50 p-4 rounded-lg border border-red-100">
                                                <div className="flex justify-between items-center mb-2">
                                                    <span className="text-red-800 font-medium">Guarantee Cost ({fmtVal(feeRate)}%)</span>
                                                    <span className="text-xl font-bold text-red-700">-{fmt(annualFee)}</span>
                                                </div>
                                                <div className="text-xs text-red-600">
                                                    Fee on the covered exposure.
                                                </div>
                                            </div>

                                            <div className="text-center pt-2">
                                                <span className="text-sm font-medium text-gray-500">ROI on Guarantee Fee</span>
                                                <div className="text-2xl font-bold text-gray-800">{(netMPOBenefit/annualFee).toFixed(1)}x</div>
                                            </div>
                                        </div>
                                    </div>
                                </Card>
                            )}

                            {/* Strategic Insight Box */}
                            <div className="bg-gradient-to-r from-gray-800 to-gray-700 p-6 rounded-xl shadow-lg text-white">
                                <h4 className="font-bold text-yellow-400 mb-2 flex items-center gap-2">
                                    <div className="bg-yellow-400 rounded-full p-1 text-gray-900"><TrendingUpIcon size={12}/></div>
                                    Strategic Insight
                                </h4>
                                {activeTab === 'performing' ? (
                                    <p className="text-sm text-gray-200 leading-relaxed">
                                        By utilizing <strong>{guaranteeType}</strong> cover at <strong>{coverage}%</strong> with a fee of <strong>{fmtVal(feeRate)}%</strong>, you effectively reduce the LGD of the portfolio to <strong>{fmtP(effectiveLGD)}</strong>. 
                                        This generates a net P&L saving of <strong>{fmt(netECLBenefit)}</strong> while simultaneously freeing up <strong>{fmt(capitalSaved)}</strong> in regulatory capital.
                                        This capital, if leveraged 10x, could support <strong>{fmt(capitalSaved * 10)}</strong> in new lending.
                                    </p>
                                ) : (
                                    <p className="text-sm text-gray-200 leading-relaxed">
                                        For a classified portfolio of <strong>{fmt(exposure)}</strong>, activating MPO yields an immediate provision reversal of <strong>{fmt(provSaving)}</strong>. 
                                        The cost is minimal at <strong>{fmt(annualFee)}</strong> (at {fmtVal(feeRate)}%). This structure is highly accretive for managing NPLs, offering a <strong>{(netMPOBenefit/annualFee).toFixed(1)}x</strong> return on the fee paid.
                                    </p>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
