<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wheat Storage Dashboard</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons (Inline SVGs to remove external dependencies) ---
        // Fixed: Wrapped multi-element paths in React Fragments (<>...</>) to prevent adjacent JSX errors.
        
        const IconBase = ({ path, className = "w-6 h-6" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {path}
            </svg>
        );

        const Calculator = (props) => <IconBase {...props} path={<><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></>} />;
        const TrendingUp = (props) => <IconBase {...props} path={<><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></>} />;
        const AlertTriangle = (props) => <IconBase {...props} path={<><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></>} />;
        const Warehouse = (props) => <IconBase {...props} path={<><path d="M22 8.35V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8.35A2 2 0 0 1 3.26 6.5l8-3.2a2 2 0 0 1 1.48 0l8 3.2A2 2 0 0 1 22 8.35Z"/><path d="M6 18h12"/><path d="M6 14h12"/><rect width="12" height="12" x="6" y="10"/></>} />;
        const ShieldCheck = (props) => <IconBase {...props} path={<><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="m9 12 2 2 4-4"/></>} />;
        const MapPin = (props) => <IconBase {...props} path={<><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></>} />;
        const DollarSign = (props) => <IconBase {...props} path={<><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></>} />;
        const PieChart = (props) => <IconBase {...props} path={<><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></>} />;
        const BookOpen = (props) => <IconBase {...props} path={<><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></>} />;
        const Info = (props) => <IconBase {...props} path={<><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></>} />;


        // --- Components ---

        const Card = ({ children, className = "" }) => (
            <div className={`bg-white rounded-xl shadow-sm border border-slate-200 p-6 ${className}`}>
                {children}
            </div>
        );

        const Badge = ({ children, type = "neutral" }) => {
            const styles = {
                neutral: "bg-slate-100 text-slate-700",
                success: "bg-emerald-100 text-emerald-800",
                warning: "bg-amber-100 text-amber-800",
                danger: "bg-rose-100 text-rose-800",
                blue: "bg-blue-100 text-blue-800"
            };
            return (
                <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${styles[type] || styles.neutral}`}>
                    {children}
                </span>
            );
        };

        const SectionHeader = ({ icon: Icon, title, description }) => (
            <div className="flex items-start gap-3 mb-6">
                <div className="p-2 bg-blue-50 rounded-lg">
                    <Icon className="w-6 h-6 text-blue-600" />
                </div>
                <div>
                    <h2 className="text-xl font-bold text-slate-900">{title}</h2>
                    <p className="text-slate-500 text-sm mt-1">{description}</p>
                </div>
            </div>
        );

        // --- Main Application ---

        function WheatDashboard() {
            // --- State: Fiscal Calculator (Points 1 & 2) ---
            const [reserveSize, setReserveSize] = useState(6.0); // Million Tons
            const [interestRate, setInterestRate] = useState(10.0); // Percentage
            const [wheatPrice, setWheatPrice] = useState(95000); // PKR per ton (Assumption to fit the 70bn math)
            const [storageCostPerTon, setStorageCostPerTon] = useState(2000); // PKR per ton/year

            // Derived Fiscal Calcs
            const totalValue = (reserveSize || 0) * 1000000 * (wheatPrice || 0);
            const interestCost = totalValue * ((interestRate || 0) / 100);
            const storageCost = (reserveSize || 0) * 1000000 * (storageCostPerTon || 0);
            const totalFiscalImpact = (interestCost + storageCost) / 1000000000; // In Billions

            // --- State: Price Trigger (Point 5) ---
            const [movingAvg, setMovingAvg] = useState(3500); // PKR per 40kg
            const [currentPrice, setCurrentPrice] = useState(3800); // PKR per 40kg
            const [triggerThreshold, setTriggerThreshold] = useState(10); // %

            const safeMovingAvg = movingAvg || 1; // Prevent divide by zero
            const priceDiffPercent = (( (currentPrice || 0) - safeMovingAvg) / safeMovingAvg) * 100;
            const isTriggered = priceDiffPercent > (triggerThreshold || 0);

            // --- State: Cap Checker (Point 8) ---
            const [entityCapacity, setEntityCapacity] = useState(150000); // Tons
            const [totalRequirement] = useState(6000000); // Based on strategic reserve
            
            const marketShare = ((entityCapacity || 0) / totalRequirement) * 100;
            const capLimit = 5.0; // 5% Max
            const isMonopolyRisk = marketShare > capLimit;

            // Helper to safely handle number inputs
            const handleNumChange = (setter) => (e) => {
                const val = parseFloat(e.target.value);
                setter(isNaN(val) ? '' : val);
            };

            return (
                <div className="min-h-screen bg-slate-50 p-4 md:p-8 font-sans text-slate-800">
                <div className="max-w-6xl mx-auto space-y-8">
                    
                    {/* Header */}
                    <header className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div>
                        <h1 className="text-3xl font-bold text-slate-900 tracking-tight">Wheat Strategic Framework</h1>
                        <p className="text-slate-500 mt-2">Interactive impact analysis based on submitted comments</p>
                    </div>
                    <div className="flex gap-2">
                        <Badge type="blue">Draft Comments</Badge>
                        <Badge type="neutral">Nov 2025</Badge>
                    </div>
                    </header>

                    {/* Executive Summary Cards */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <Card className="bg-gradient-to-br from-blue-600 to-blue-700 text-white border-none">
                        <div className="flex justify-between items-start">
                        <div>
                            <p className="text-blue-100 text-sm font-medium opacity-90">Current Proposal</p>
                            <h3 className="text-3xl font-bold mt-1">6.0 M</h3>
                            <p className="text-sm mt-1 opacity-80">Tons Strategic Reserve</p>
                        </div>
                        <Warehouse className="w-8 h-8 opacity-50" />
                        </div>
                        <div className="mt-4 pt-4 border-t border-blue-500/30 text-sm text-blue-100">
                        Covers ~45 days full consumption
                        </div>
                    </Card>

                    <Card>
                        <div className="flex justify-between items-start">
                        <div>
                            <p className="text-slate-500 text-sm font-medium">Est. Annual Cost</p>
                            <h3 className="text-3xl font-bold mt-1 text-slate-900">PKR 70 Bn+</h3>
                            <p className="text-sm mt-1 text-slate-500">Based on 10% Interest</p>
                        </div>
                        <DollarSign className="w-8 h-8 text-emerald-500 opacity-50" />
                        </div>
                        <div className="mt-4 pt-4 border-t border-slate-100 text-sm text-amber-600 font-medium flex items-center gap-2">
                        <AlertTriangle className="w-4 h-4" />
                        High sensitivity to interest rates
                        </div>
                    </Card>

                    <Card>
                        <div className="flex justify-between items-start">
                        <div>
                            <p className="text-slate-500 text-sm font-medium">Policy Focus</p>
                            <h3 className="text-3xl font-bold mt-1 text-slate-900">Market First</h3>
                            <p className="text-sm mt-1 text-slate-500">Minimize Distortions</p>
                        </div>
                        <ShieldCheck className="w-8 h-8 text-indigo-500 opacity-50" />
                        </div>
                        <div className="mt-4 pt-4 border-t border-slate-100 text-sm text-slate-600">
                        Targeted subsidies {'>'} Retail caps
                        </div>
                    </Card>
                    </div>

                    {/* Main Content Grid */}
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    
                    {/* CALCULATOR 1: Fiscal Impact */}
                    <section className="space-y-4">
                        <SectionHeader 
                        icon={Calculator} 
                        title="Fiscal Impact Simulator" 
                        description="Analyze the cost of maintaining strategic reserves (Points 1 & 2)." 
                        />
                        
                        <Card>
                        <div className="space-y-6">
                            {/* Inputs */}
                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-6">
                            <div>
                                <label className="block text-sm font-semibold text-slate-700 mb-2">
                                Reserve Size (Million Tons)
                                </label>
                                <input 
                                type="range" 
                                min="1" 
                                max="10" 
                                step="0.5"
                                value={isNaN(reserveSize) ? 0 : reserveSize}
                                onChange={handleNumChange(setReserveSize)}
                                className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600"
                                />
                                <div className="flex justify-between mt-2 text-sm text-slate-500">
                                <span>1M</span>
                                <span className="font-bold text-blue-600">{reserveSize || 0} M Tons</span>
                                <span>10M</span>
                                </div>
                            </div>

                            <div>
                                <label className="block text-sm font-semibold text-slate-700 mb-2">
                                Interest Rate (%)
                                </label>
                                <input 
                                type="number" 
                                value={interestRate}
                                onChange={handleNumChange(setInterestRate)}
                                className="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-semibold text-slate-700 mb-2">
                                Wheat Price (PKR/Ton)
                                </label>
                                <input 
                                type="number" 
                                value={wheatPrice}
                                onChange={handleNumChange(setWheatPrice)}
                                className="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-semibold text-slate-700 mb-2">
                                Service/Storage (PKR/Ton)
                                </label>
                                <input 
                                type="number" 
                                value={storageCostPerTon}
                                onChange={handleNumChange(setStorageCostPerTon)}
                                className="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none"
                                />
                            </div>
                            </div>

                            {/* Results Box */}
                            <div className="bg-slate-50 rounded-lg p-5 border border-slate-200">
                            <h4 className="text-xs uppercase tracking-wider font-bold text-slate-500 mb-4">Projected Annual Liability</h4>
                            
                            <div className="space-y-3">
                                <div className="flex justify-between items-center text-sm">
                                <span className="text-slate-600">Interest Cost:</span>
                                <span className="font-mono text-slate-900">PKR {(interestCost / 1000000000).toFixed(1)} Bn</span>
                                </div>
                                <div className="flex justify-between items-center text-sm">
                                <span className="text-slate-600">Storage & Service:</span>
                                <span className="font-mono text-slate-900">PKR {(storageCost / 1000000000).toFixed(1)} Bn</span>
                                </div>
                                <div className="h-px bg-slate-300 my-2"></div>
                                <div className="flex justify-between items-center">
                                <span className="font-bold text-slate-800">Total Fiscal Impact:</span>
                                <span className={`font-bold font-mono text-xl ${totalFiscalImpact > 70 ? 'text-rose-600' : 'text-emerald-600'}`}>
                                    PKR {totalFiscalImpact.toFixed(1)} Billion
                                </span>
                                </div>
                            </div>
                            
                            {totalFiscalImpact > 70 && (
                                <div className="mt-4 flex items-start gap-2 text-rose-700 bg-rose-50 p-3 rounded text-xs leading-relaxed">
                                <AlertTriangle className="w-4 h-4 flex-shrink-0 mt-0.5" />
                                Note: Costs exceed the referenced 70 Bn benchmark. Point 1 suggests "a case for maintaining lower reserves" to mitigate this.
                                </div>
                            )}
                            </div>
                        </div>
                        </Card>
                    </section>

                    {/* CALCULATOR 2 & 3: Mechanisms */}
                    <section className="space-y-8">
                        
                        {/* Price Stabilization */}
                        <div>
                        <SectionHeader 
                            icon={TrendingUp} 
                            title="Release Trigger Mechanism" 
                            description="Simulate rules-based stock release (Point 5)." 
                        />
                        <Card>
                            <div className="space-y-4">
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                <label className="block text-xs font-semibold text-slate-500 mb-1">3-Year Moving Avg (PKR)</label>
                                <input 
                                    type="number" 
                                    value={movingAvg}
                                    onChange={handleNumChange(setMovingAvg)}
                                    className="w-full p-2 bg-slate-50 border border-slate-200 rounded text-sm"
                                />
                                </div>
                                <div>
                                <label className="block text-xs font-semibold text-slate-500 mb-1">Current Retail Price (PKR)</label>
                                <input 
                                    type="number" 
                                    value={currentPrice}
                                    onChange={handleNumChange(setCurrentPrice)}
                                    className="w-full p-2 bg-slate-50 border border-slate-200 rounded text-sm"
                                />
                                </div>
                            </div>

                            <div className="pt-2">
                                <div className="flex justify-between text-sm mb-2">
                                <span className="text-slate-600">Price Deviation:</span>
                                <span className={`font-bold ${priceDiffPercent > 0 ? 'text-rose-600' : 'text-emerald-600'}`}>
                                    {priceDiffPercent > 0 ? '+' : ''}{isNaN(priceDiffPercent) ? '0.0' : priceDiffPercent.toFixed(1)}%
                                </span>
                                </div>
                                <div className="w-full bg-slate-200 h-2 rounded-full overflow-hidden">
                                <div 
                                    className={`h-full ${isTriggered ? 'bg-rose-500' : 'bg-emerald-500'}`} 
                                    style={{ width: `${isNaN(priceDiffPercent) ? 0 : Math.min(Math.abs(priceDiffPercent) * 2, 100)}%` }}
                                ></div>
                                </div>
                                <p className="text-xs text-slate-400 mt-1">Threshold set at {triggerThreshold}% increase</p>
                            </div>

                            <div className={`p-4 rounded-lg flex items-center gap-3 border ${isTriggered ? 'bg-rose-50 border-rose-100' : 'bg-slate-50 border-slate-100'}`}>
                                {isTriggered ? <AlertTriangle className="text-rose-600 w-6 h-6"/> : <ShieldCheck className="text-emerald-600 w-6 h-6"/>}
                                <div>
                                <p className={`font-bold text-sm ${isTriggered ? 'text-rose-800' : 'text-slate-800'}`}>
                                    {isTriggered ? "TRIGGER ACTIVATED" : "Market Stable"}
                                </p>
                                <p className="text-xs text-slate-600">
                                    {isTriggered 
                                    ? "Release strategic stock to stabilize prices immediately." 
                                    : "Price is within acceptable variance range."}
                                </p>
                                </div>
                            </div>
                            </div>
                        </Card>
                        </div>

                        {/* Anti-Monopoly */}
                        <div>
                        <SectionHeader 
                            icon={PieChart} 
                            title="Storage Cap Compliance" 
                            description="Verify warehouse capacity limits (Point 8)." 
                        />
                        <Card>
                            <div className="flex items-center gap-4">
                            <div className="flex-1">
                                <label className="block text-xs font-semibold text-slate-500 mb-1">Single Entity Capacity (Tons)</label>
                                <input 
                                type="number" 
                                value={entityCapacity}
                                onChange={handleNumChange(setEntityCapacity)}
                                className="w-full p-2 bg-slate-50 border border-slate-200 rounded text-sm"
                                />
                            </div>
                            <div className="flex-1 text-center">
                                <p className="text-xs text-slate-500 mb-1">Market Share</p>
                                <p className="text-xl font-bold text-slate-900">{isNaN(marketShare) ? '0.00' : marketShare.toFixed(2)}%</p>
                            </div>
                            <div className="flex-1">
                                <Badge type={isMonopolyRisk ? "danger" : "success"}>
                                    {isMonopolyRisk ? "Violation" : "Compliant"}
                                </Badge>
                            </div>
                            </div>
                            {isMonopolyRisk && (
                            <p className="text-xs text-rose-600 mt-3">
                                Exceeds the 2.5% - 5% strategic storage cap recommendation.
                            </p>
                            )}
                        </Card>
                        </div>

                    </section>
                    </div>

                    {/* Policy Recommendations Grid */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-8">
                    <Card className="bg-slate-50 border-none">
                        <BookOpen className="w-6 h-6 text-blue-600 mb-3" />
                        <h4 className="font-bold text-slate-900 mb-2">Audit & Fungibility</h4>
                        <p className="text-xs text-slate-600 leading-relaxed">
                            Commodity is fungible. Requires annual audits or ring-fenced silos to ensure strategic stock quality isn't compromised (Point 3).
                        </p>
                    </Card>

                    <Card className="bg-slate-50 border-none">
                        <MapPin className="w-6 h-6 text-blue-600 mb-3" />
                        <h4 className="font-bold text-slate-900 mb-2">Location Strategy</h4>
                        <p className="text-xs text-slate-600 leading-relaxed">
                            Locate near production/demand. Avoid flood zones. Rule: Truckload must reach demand center within 24 hours (Point 9).
                        </p>
                    </Card>

                    <Card className="bg-slate-50 border-none">
                        <DollarSign className="w-6 h-6 text-blue-600 mb-3" />
                        <h4 className="font-bold text-slate-900 mb-2">Targeted Subsidy</h4>
                        <p className="text-xs text-slate-600 leading-relaxed">
                            Avoid retail price caps. Use BISP for direct subsidies triggered by $1+X\%$ price increases (Point 4).
                        </p>
                    </Card>

                    <Card className="bg-slate-50 border-none">
                        <Warehouse className="w-6 h-6 text-blue-600 mb-3" />
                        <h4 className="font-bold text-slate-900 mb-2">Licensing Tiers</h4>
                        <p className="text-xs text-slate-600 leading-relaxed">
                            Two tiers: <strong>Strategic</strong> (Strict financials, holds reserves) vs <strong>Private</strong> (Lighter reqs, general storage) (Point 7).
                        </p>
                    </Card>
                    </div>

                    {/* Footer */}
                    <div className="mt-8 border-t border-slate-200 pt-6 flex flex-col md:flex-row justify-between items-center text-slate-400 text-sm">
                    <p>Â© 2025 Strategic Wheat Storage Initiative</p>
                    <div className="flex items-center gap-2 mt-2 md:mt-0">
                        <Info className="w-4 h-4" />
                        <span>Data derived from "Comments on Wheat / Storage Framework"</span>
                    </div>
                    </div>

                </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<WheatDashboard />);
    </script>
</body>
</html>
